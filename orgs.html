
<!doctype html><html><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Organizations â€” PH Small Biz</title>
<style>:root{font-family:system-ui} body{margin:0;background:#f6f7fb;color:#111} .wrap{max-width:860px;margin:2rem auto;padding:1rem} .card{background:#fff;padding:1rem;border-radius:14px;box-shadow:0 8px 24px rgba(0,0,0,.06);margin-bottom:1rem} input,button{padding:.6rem;border:1px solid #dadde5;border-radius:10px} button{background:#1f6feb;color:#fff;border:none;cursor:pointer} table{width:100%;border-collapse:collapse} th,td{padding:.6rem;border-bottom:1px solid #eee} nav a{margin-right:.6rem}</style>
</head><body><div class="wrap">
  <nav style="margin-bottom:1rem">
    <a href="dashboard.html">Dashboard</a>
    <a href="forms.html">Tax Forms</a>
    <a href="settings.html">Settings</a>
    <a href="import.html">Import CSV</a>
    <a href="import2307.html">Import 2307</a>
    <a href="orgs.html">Organizations</a>
  </nav>
  <section class="card">
    <h2>Organizations</h2>
    <div class="row"><input id="name" placeholder="New org name"/> <input id="tin" placeholder="TIN (optional)"/> <button id="add">Add Organization</button></div>
    <table id="tbl"><thead><tr><th>ID</th><th>Name</th><th>TIN</th><th>Switch</th></tr></thead><tbody></tbody></table>
  </section>
</div>
<script type="module" src="/nav.js"></script>
<script type="module">
async function load(){
  const rows = await fetch('/api/orgs').then(r=>r.json());
  const tb = document.querySelector('#tbl tbody');
  tb.innerHTML = rows.map(r=>`<tr><td>${r.id}</td><td>${r.name}</td><td>${r.tin||''}</td><td><button data-id="${r.id}" class="sw">Use</button></td></tr>`).join('');
  tb.querySelectorAll('button.sw').forEach(b=>b.addEventListener('click', async ()=>{
    await fetch('/api/orgs/switch',{ method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ org_id: Number(b.dataset.id) })});
    alert('Switched!'); location.href = '/dashboard.html';
  }));
}
document.getElementById('add').addEventListener('click', async ()=>{
  const name = document.getElementById('name').value.trim();
  const tin = document.getElementById('tin').value.trim();
  if (!name) return alert('Enter a name');
  await fetch('/api/orgs', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ name, tin }) });
  document.getElementById('name').value=''; document.getElementById('tin').value='';
  load();
});
load();
</script>
</body></html>
